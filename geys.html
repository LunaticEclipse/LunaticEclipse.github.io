<!DOCTYPE html>
<html>

<head>
	<style>
		body {
			background-color:  #929292;
		}
	</style>
</head>

<body>

<canvas id="danmaku" width="1500" height="800" style="border:0px solid #000000;"></canvas>


<script type="text/javascript" src="mathFunctions.js"></script>
<script type="text/javascript" src="danmaku.js"></script>


<script>
	// player starting position!!
	touhou = true;
	toggle = true;
	const body = document.querySelector('body');
	var project = true;

	var x = cx-50;
	var y = 600;

	var energy = 3;
	var warming = 0;

	var die = new Audio();
	die.src = "sound/die.wav";

	var sound = [];

	sound[0] = new Audio();
	sound[0].src = "sound/shoot0.wav";
	sound[1] = new Audio();
	sound[1].src = "sound/shoot1.wav";
	sound[2] = new Audio();
	sound[2].src = "sound/shoot2.wav";


	function map(){
		if(t%100 == 0){
			drop(400 + random(650));
		}
		if(t%150 == 0 && t<=1000){
			spawn(cx-250, 200, 5, pattern1, 0.7, pi/2);
			spawn(cx+250, 200, 5, pattern1, 0.7, pi/2);
		}

		if(t==1500){
			spawn(cx, cy-250, 200, pattern2, 0, 0);
		}
	}

	function pattern1(xe, ye){
		
		if(t%100 == 0) {
			shootAccRing(xe,ye,3,-0.1,1.5,random(4),12,10,"#000000")
			//shootRing(xe, ye, 2, t/50, 3, 0, "#000000");
			//shootRing(xe, ye, 2.5, t/50, 3, 0, "#000000");
		}
		
	}

	function pattern2(){
		if(abs(t)%12==0){
			for(let i = 0; i < 8; i++){
				let j = i*pi/4+sq(t)/5000
				shoot1(cx, cy-300, 1, j, "#880088");

			}
		}
	}

	function pattern(){

		if(shooting && cooldown<=0 && energy > 0){
			shooting = false;
			cooldown = 100;

			energy--;

			sound[random(3)].play();

			for(let i = 0; i < 21; i+=1){
				shoot(x, y-10,5, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
				shoot(x, y-10,6, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
				shoot(x, y-10,4, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
				shoot(x, y-10,5.5, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
				shoot(x, y-10,6.5, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
				shoot(x, y-10,4.5, -30*pi/40 + i*pi/40 ,"#dddddd")
				bullets[count-1].player = true;
			}
		}

		for(let i = 0; i<countE; i+=1){
			if(enemy[i].hp > 0) {enemy[i].attack(enemy[i].x, enemy[i].y);}
		}
		
	}


	function game(){

		var over = false;

	function mainLoop(){
		if(warming == 0) {body.style.backgroundColor = "#929292";}
		else if (warming == 1) {body.style.backgroundColor = "#727272";}
		else if (warming == 2) {body.style.backgroundColor = "#525252";}
		else {body.style.backgroundColor = "#323232";}
		map();
		pattern();
		WASD()
		draw();
		t++;
		if(cooldown>0) {cooldown-=1;}

		if(deathCount > 0)	{
			over = true;
			clearInterval(brake);
		}
	}
	var brake = setInterval(mainLoop, 8);

	die.play();

	}

	game();



</script>